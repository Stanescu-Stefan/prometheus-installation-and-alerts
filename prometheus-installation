
#To install Prometheus, we need to access https://prometheus.io/download
#Then we download the tarball to our server

wget https://github.com/prometheus/prometheus/releases/download/v2.45.1/prometheus-2.45.1.linux-amd64.tar.gz

#We unarchive the downloaded file

tar xvf prometheus-2.45.1.linux-amd64.tar.gz

#After unarchiving it, we go into the unarchived directory
cd prometheus-2.45.1.linux-amd64/

#We check the available files and directories

ls -al

#You will see several files. the most important ones are
#prometheus file is the application executable
#prometheuus.yml is the config file
#promtool is a command-line utility


#To check if prometheus can start with issues, run ./prometheus

#We can go and check http://localhost:9090/ on your local machine to see the Prometheus expression browser.

#You can type up, you should see 1 target in an up state, prometheus itself


up{instance=""locahost:9090", job="prometheus"}                    1

#When we start Prometheus by running ./prometheus, it will start running in the foreground and also it will not start on boot.
#So we need to configure it as a Systemd service unit so we could do systemctl start prometheus


#First we need to create a prometheus user.

sudo useradd --no-create-home --shell /bin/false prometheus

#So the user cant login in

#After that we need to create directories to move some our prometheus files
sudo mkdir /etc/prometheus (to store the prometheus.yml, a config file)

sudo mkdir /var/lib/prometheus(to store the time series data)

#We change the ownership of these directories to the prometheus user/group
sudo chown prometheus:prometheus /etc/prometheus

sudo chown prometheus:prometheus /var/lib/prometheus



#Now we copy the prometheus executable to /usr/local/bin/

sudo cp prometheus /usr/local/bin/

sudo cp promtool /usr/local/bin/

#We change the ownership of these directories to the prometheus user/group

sudo chown prometheus:prometheus /usr/local/bin/prometheus

sudo chown prometheus:prometheus /usr/local/bin/promtool

#Copy the consoles and console libraries folder

sudo cp -r consoles /etc/prometheus

sudo cp -r console_libraries /etc/prometheus

#We change the ownership of these directories to the prometheus user/group

sudo chown -R prometheus:prometheus /etc/prometheus/consoles

sudo chown -R prometheus:prometheus /etc/prometheus/console_libraries

#Next we copy the configuration file

sudo cp prometheus.yml /etc/prometheus/

#We change the ownership of this file to the prometheus user/group

sudo chown prometheus:prometheus /etc/prometheus/prometheus.yml


#After that the command to start the prometheus is:


sudo -u prometheus /usr/local/bin/prometheus \
 --config.file /etc/prometheus/prometheus.yml\
--storage.tsdb.path /var/lib/prometheus/ \
--web.console.templates=/etc/prometheus/consoles \
--web.console.libraries=/etc/prometheus/console_libraries


#The next thing we need to create a unit service file for our prometheus server service


sudo vi /etc/systemd/system/prometheus.service

#Copy the following text into the systemd service unit file

[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
 --config.file /etc/prometheus/prometheus.yml\
--storage.tsdb.path /var/lib/prometheus/ \
--web.console.templates=/etc/prometheus/consoles \
--web.console.libraries=/etc/prometheus/console_libraries

[Install]
WantedBy=multi-user.target


#Since we changed a Systemd unit file we need to do the following command:

sudo systemctl daemon-reload

#Then start prometheus

sudo systemctl start prometheus

#Also enable it

sudo systemctl enable prometheus



#*****************************NODE EXPORTER******************************

#Node exporters expose the metrics from the node they are installed on, so that the prometheus server can scrape that endpoint

To install Node exporter, we need to access https://prometheus.io/download and select node_exporter
