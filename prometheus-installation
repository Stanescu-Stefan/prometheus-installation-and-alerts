

wget https://github.com/prometheus/prometheus/releases/download/v2.45.1/prometheus-2.45.1.linux-amd64.tar.gz

tar xvf prometheus-2.45.1.linux-amd64.tar.gz

cd prometheus-2.45.1.linux-amd64/


ls -al
you will see several files. the most important ones are

prometheus file is the application executable

prometheuus.yml is the config file

promtool is a command-line utility


to check if prometheus can start with issues, run ./prometheus

we can go and check http://localhost:9090/ on your local machine to see the Prometheus expression browser.

You can type up, you should see 1 target in an up state, prometheus itself


up{instance=""locahost:9090", job="prometheus"}                    1

When we start Prometheus by running ./prometheus, it will start running in the foreground and also it will not start on boot.

so we need to configure it as a Systemd service unit so we could do systemctl start prometheus


first we need to create a prometheus user.

sudo useradd --no-create-home --shell /bin/false prometheus

so the user cant login in

sudo mkdir /etc/prometheus (to store the prometheus.yml, a config file)

sudo mkdir /var/lib/prometheus(to store the time series data)

sudo chown prometheus:prometheus /etc/prometheus

sudo chown prometheus:prometheus /var/lib/prometheus



now we copy the prometheus executable to /usr/local/bin/

sudo cp prometheus /usr/local/bin/

sudo cp promtool /usr/local/bin/

also update the permissions of both those files

sudo chown prometheus:prometheus /usr/local/bin/prometheus

sudo chown prometheus:prometheus /usr/local/bin/promtool

copy the console folder

sudo cp -r consoles /etc/prometheus

sudo cp -r console_libraries /etc/prometheus

also update the permissions

sudo chown -R prometheus:prometheus /etc/prometheus/consoles

sudo chown -R prometheus:prometheus /etc/prometheus/console_libraries

next we copy the configuration file

sudo cp prometheus.yml /etc/prometheus/

sudo chown prometheus:prometheus /etc/prometheus/prometheus.yml


after that the command to start the prometheus is:


sudo -u prometheus /usr/local/bin/prometheus \
 --config.file /etc/prometheus/prometheus.yml\
--storage.tsdb.path /var/lib/prometheus/ \
--web.console.templates=/etc/prometheus/consoles \
--web.console.libraries=/etc/prometheus/console_libraries


the next thing we need to create a unit service file for our prometheus server service


sudo vi /etc/systemd/system/prometheus.service


[Unit]
Description=Prometheus
Wants=network-online.target
After=network-online.target

[Service]
User=prometheus
Group=prometheus
Type=simple
ExecStart=/usr/local/bin/prometheus \
 --config.file /etc/prometheus/prometheus.yml\
--storage.tsdb.path /var/lib/prometheus/ \
--web.console.templates=/etc/prometheus/consoles \
--web.console.libraries=/etc/prometheus/console_libraries

[Install]
WantedBy=multi-user.target


Since we changed a Systemd unit file we need to do the following command:

sudo systemctl daemon-reload

Then start prometheus

sudo systemctl start prometheus

Also enable it

sudo systemctl enable prometheus
